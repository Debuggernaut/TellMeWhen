
trigger:
- master
- classic

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
  submodules: true

- bash: sudo apt-get install -y pandoc
  displayName: "Install Packages"

- bash: sudo chmod +x ./create-lua-changelog.sh && ./create-lua-changelog.sh
  displayName: "Build Changelog"
  workingDirectory: $(Build.SourcesDirectory)/build

- bash: sudo chmod +x ./release.sh && ./release.sh
  displayName: "Package and Upload"
  workingDirectory: $(Build.SourcesDirectory)/build/lib/packager

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(Build.SourcesDirectory)/.release/
    artifactName: release