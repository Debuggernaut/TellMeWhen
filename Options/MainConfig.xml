<Ui>

	<Frame parentKey="Changelog" inherits="TellMeWhen_IE_PageTemplate">
		<Frames>

			<Frame parentKey="Container">
				<Anchors>
					<Anchor point="TOP" y="-5"/>
					<Anchor point="BOTTOM" y="5"/>
					<Anchor point="LEFT" x="5" />
					<Anchor point="RIGHT" x="-2" />
				</Anchors>

				<Frames>
					<SimpleHTML parentKey="HTML" justifyH="LEFT" justifyV="TOP">
						<Size x="1" y="1"/>
						<Anchors>
							<Anchor point="TOPLEFT" y="-10" X="10" />
						</Anchors>
						<Scripts>
							<OnLoad>
								local font = "Interface/Addons/TellMeWhen/Fonts/OpenSans-Regular.ttf"

								-- Just incase they haven't restarted after installing the version
								-- that first included this font (v7.3.5)
								if not self:SetFont(font, 12) then
									font = "Fonts\\FRIZQT__.TTF"
								end

								self:SetFont(font, 12)
								self:SetFont("h1", font, 20)
								self:SetFont("h2", font, 14)

								self:SetSpacing("h1", 10)
								self:SetSpacing("h2", 6)
								self:SetSpacing("p", 5)
								self:SetIndentedWordWrap("p", true)

								self:SetTextColor("h1", 0xFF/0xFF, 0x63/0xFF, 0x00/0xFF)
								self:SetTextColor("h2", 0x00/0xFF, 0xF1/0xFF, 0xFF/0xFF)
							</OnLoad>
						</Scripts>
					</SimpleHTML>
				</Frames>
				<Scripts>
					<OnLoad>
						TMW:ConvertContainerToScrollFrame(self, false, 0, 12)
						self.ScrollFrame:SetWheelStepAmount(25)
					</OnLoad>
					<OnShow>
						TMW.IE:ShowChangelog()
						self:GetScript("OnSizeChanged")(self)
					</OnShow>
					<OnSizeChanged>
						-- SimpleHTML doesn't wrap properly with anchors set on the left and right.
						-- We have to set one only on the left, and use this to adjust the wrappping.
						-- The SetText call is absolutely required for the wrapping to get recalculated.

						self.HTML:SetWidth(self:GetWidth()-35)
						self.HTML:SetText(self.HTML.text)
					</OnSizeChanged>
				</Scripts>
			</Frame>

		</Frames>
	</Frame>


	<Frame parentKey="Main" inherits="TellMeWhen_IE_PageTemplate">
		<Frames>
			<Frame parentKey="PanelsLeft" inherits="TellMeWhen_IE_PanelColumn">
				<Anchors>
					<Anchor point="LEFT" x="7"/>
					<Anchor point="RIGHT" relativePoint="TOP" x="-6"/>
				</Anchors>
			</Frame>

			<Frame parentKey="PanelsRight" inherits="TellMeWhen_IE_PanelColumn">
				<Anchors>
					<Anchor point="LEFT" relativePoint="TOP" x="5"/>
					<Anchor point="RIGHT" x="-9"/>
				</Anchors>
				<Scripts>
					<OnLoad inherit="prepend">
						self:CScriptAdd("SettingTableRequested", function()
							return TMW.db.global
						end)
					</OnLoad>
				</Scripts>
			</Frame>

			<CheckButton parentKey="Locked" inherits="TellMeWhen_CheckTemplate">
				<Anchors>
					<Anchor point="TOP" relativeKey="$parent" relativePoint="TOP" x="0" y="-4"/>
					<Anchor point="LEFT" relativeKey="$parent.PanelsRight" relativePoint="LEFT" />
				</Anchors>
				<Scripts>
					<OnLoad>
						TMW:CInit(self)

						self:SetTexts(TMW.L["UIPANEL_LOCKUNLOCK"], TMW.L["UIPANEL_SUBTEXT2"])
						self:SetSetting("Locked")

					</OnLoad>
				</Scripts>
			</CheckButton>

		</Frames>
		<Scripts>
			<OnLoad>
				TMW:CInit(self)

				self:CScriptAdd("SettingTableRequested", function(requester)
					return TMW.db.profile
				end)

				self:CScriptAdd("ReloadRequested", function(requester)

					local panelList = {}
					for ComponentClass in pairs(TMW.C.GenericComponent.inheritedBy) do
						for _, panelInfo in pairs(ComponentClass.ConfigPanels) do
							if panelInfo.panelSet == "main" then
								tinsert(panelList, panelInfo)
							end
						end		
					end

					TMW.tRemoveDuplicates(panelList)

					TMW.IE:PositionPanels("Main", panelList)
				end)

			</OnLoad>
		</Scripts>
	</Frame>
</Ui>